{% extends "base.html" %}
{% block title %}{{ offer.title }} ‚Äî The Hive{% endblock %}
{% block content %}

<div class="offer-card">

  <div style="display:flex; flex-wrap:wrap; gap:24px;">

    <!-- LEFT SIDE -->
    <div style="flex:1; min-width:260px;">

      <!-- Title -->
      <h2 class="need-title" style="font-size:1.7rem;">{{ offer.title }}</h2>

      <!-- Offer Badge -->
      <span class="type-badge offer">Offer</span>

      <!-- Meta Info (same style as Need page) -->
      <p><strong>Hours:</strong> {{ offer.hours }}</p>
      <p><strong>Location:</strong> {{ offer.location }}</p>

      <!-- Description -->
      <p style="margin-top:10px;">
        {{ offer.description }}
      </p>

      <!-- Offered by -->
      <p style="margin-top:18px;">
        <strong>Offered by:</strong>
        <a href="{{ url_for('profile', user_id=offer.user_id) }}"
           style="color:#ffd84d; text-decoration:none;">
          {{ offer.user.email.split('@')[0] }}
        </a>
      </p>

      <!-- Favorite Button (same style as Need) -->
        <form action="/toggle-favorite/{{ offer.offer_id }}" method="post" style="display:inline;">
          <button class="favorite-btn {% if offer.offer_id in user_favorites %}filled{% endif %}">
            {% if offer.offer_id in user_favorites %} ‚ô• {% else %} ‚ô° {% endif %}
          </button>
        </form>


      <!-- Send Message -->
      <div style="margin-top:16px;">
        <a href="{{ url_for('chat', user_id=offer.user_id, listing_id=offer.offer_id, type='offer') }}"
   class="btn-msg">
    üí¨ Send Message
</a>

      </div>

    </div>

    <!-- RIGHT SIDE (IMAGE) -->
    {% if offer.image_filename %}
      <div style="flex:0 0 280px;">
        <img src="{{ url_for('static', filename='uploads/' ~ offer.image_filename) }}"
             style="width:100%; border-radius:12px;">
      </div>
    {% endif %}

  </div>

  <hr style="margin:26px 0; opacity:0.5;">

  <!-- MAP SECTION -->
  <h3>Location on Map</h3>
  <div id="map" style="height:380px; border-radius:12px; margin-top:12px;"></div>

</div>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const lat = {{ offer.latitude|default("null") }};
  const lon = {{ offer.longitude|default("null") }};

  if (lat && lon) {
    const map = L.map('map').setView([lat, lon], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);
    L.marker([lat, lon]).addTo(map)
      .bindPopup("{{ offer.location }}")
      .openPopup();
  } else {
    const mapDiv = document.getElementById('map');
    mapDiv.innerHTML = "üìç Location not available.";
    mapDiv.style.textAlign = "center";
    mapDiv.style.padding = "40px";
  }
</script>

{% endblock %}



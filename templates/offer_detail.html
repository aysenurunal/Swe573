{% extends "base.html" %}
{% block title %}{{ offer.title }} ‚Äî The Hive{% endblock %}
{% block content %}

<div class="offer-card">

  <!-- GRID LAYOUT -->
  <div style="display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start;">

    <!-- LEFT: TEXT INFO -->
    <div style="flex:1; min-width:240px;">
      <h2 class="offer-title">{{ offer.title }}</h2>

      <p><strong>Hours:</strong> {{ offer.hours }}</p>
      <p><strong>Location:</strong> {{ offer.location }}</p>

      <p style="margin-top:12px;">
        {{ offer.description }}
      </p>

      <p style="margin-top:18px;">
        <strong>Posted by:</strong>
        <a href="{{ url_for('profile', user_id=offer.user_id) }}" style="color:#ffd84d;">
          {{ offer.user.username }}
        </a>
      </p>

      <div style="margin-top:18px; display:flex; gap:12px; flex-wrap:wrap;">

        <!-- Message Button -->
      <a href="{{ url_for('chat', user_id=offer.user_id) }}"
         class="btn"
         style="padding:10px 18px; font-size:0.95rem; background:#ffd84d; color:black; border-radius:10px; text-decoration:none; display:inline-block; margin:6px 0;">
        üí¨ Send Message
      </a>



        <!-- Hour Offer Button -->
        {% for h in range(1, offer.hours) %}
          <form action="#" method="post">
            <button style="padding:8px 14px; background:#333; border-radius:8px; color:white; border:none; cursor:pointer;">
              {{ h }} hour offer
            </button>
          </form>
        {% endfor %}

      </div>
    </div>

    <!-- RIGHT: IMAGE -->
    {% if offer.image_filename %}
    <div style="flex:0 0 260px;">
      <img src="{{ url_for('static', filename='uploads/' ~ offer.image_filename) }}"
           style="width:100%; border-radius:10px;">
    </div>
    {% endif %}

  </div> <!-- END FLEX -->

  <hr style="margin: 24px 0; opacity:0.5;">

  <!-- MAP SECTION -->
  <h3>Location on Map</h3>
  <div id="map" style="height:380px; border-radius:10px; margin-top:10px;"></div>

</div>

<!-- LEAFLET MAP -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const lat = {{ offer.latitude|default("null") }};
  const lon = {{ offer.longitude|default("null") }};

  if (lat && lon) {
    const map = L.map('map').setView([lat, lon], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    L.marker([lat, lon]).addTo(map)
      .bindPopup("{{ offer.location }}")
      .openPopup();
  } else {
    document.getElementById('map').innerHTML = "üîç Location could not be mapped.";
    document.getElementById('map').style.textAlign = "center";
    document.getElementById('map').style.padding = "40px";
  }
</script>

{% endblock %}

